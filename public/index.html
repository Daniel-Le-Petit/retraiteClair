<!DOCTYPE html>
<html lang="fr">
  <head>
    <!-- Google Analytics 4 (GA4) - Charg√© uniquement apr√®s consentement -->
    <script>
      // Ne charger Google Analytics que si le consentement a √©t√© donn√©
      function loadGoogleAnalytics() {
        if (typeof window.gtag === 'undefined') {
          // Cr√©er la fonction gtag avant de charger le script
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          window.gtag = gtag;
          gtag('js', new Date());
          
          // Charger le script Google Analytics
          const script = document.createElement('script');
          script.async = true;
          script.src = 'https://www.googletagmanager.com/gtag/js?id=G-9WF389CM13';
          document.head.appendChild(script);
          
          // Configuration GA4
          gtag('config', 'G-9WF389CM13', {
            'send_page_view': true,
            'anonymize_ip': true,
            'cookie_flags': 'SameSite=None;Secure'
          });
          
          gtag('consent', 'grant', {
            'analytics_storage': 'granted'
          });
        }
      }
      
      // V√©rifier le consentement existant au chargement
      const existingConsent = localStorage.getItem('retraiteClair_cookieConsent') || localStorage.getItem('consent-given');
      if (existingConsent === 'accepted' || existingConsent === 'true') {
        loadGoogleAnalytics();
      } else {
        // Initialiser gtag en mode refus√© par d√©faut
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        window.gtag = gtag;
        gtag('js', new Date());
        gtag('consent', 'default', {
          'analytics_storage': 'denied'
        });
      }
    </script>
    <!-- End Google Analytics 4 -->
    
    <!-- Google Fonts - Montserrat -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700;800&display=swap" rel="stylesheet">
    
    <meta charset="utf-8" />
    <link rel="icon" href="%PUBLIC_URL%/favicon.ico" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="#2563eb" />
    <meta name="description" content="Estimez vos revenus de retraite progressive 2025 en 2 minutes. Gratuit, sans inscription. D√©couvrez votre √©ligibilit√© d√®s maintenant." />
    <meta name="keywords" content="retraite progressive, simulateur, calcul, pension, temps partiel, CARSAT" />
    <meta name="author" content="Daniel Le Petit" />
    <meta name="article:published_time" content="2024-01-01T00:00:00Z" />
    <meta property="article:published_time" content="2024-01-01T00:00:00Z" />
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://retraiteclair.onrender.com/" />
    <meta property="og:title" content="Calculez votre Retraite Progressive en 2 min ‚Äì Simulateur Gratuit 2025 | RetraiteClair" />
    <meta property="og:description" content="Estimez vos revenus de retraite progressive 2025 en 2 minutes. Gratuit, sans inscription. D√©couvrez votre √©ligibilit√© d√®s maintenant." />
    <meta property="og:image" content="https://retraiteclair.onrender.com/retraite-progressive-hero.png" />
    <meta property="og:image:width" content="1200" />
    <meta property="og:image:height" content="630" />
    <meta property="og:image:type" content="image/png" />
    <meta property="og:image:alt" content="Retraite Progressive - Travail √† temps partiel, revenus optimis√©s" />
    <meta property="og:site_name" content="RetraiteClair" />
    <meta property="og:locale" content="fr_FR" />
    <meta property="article:author" content="Daniel Le Petit" />

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image" />
    <meta property="twitter:url" content="https://retraiteclair.onrender.com/" />
    <meta property="twitter:title" content="Calculez votre Retraite Progressive en 2 min ‚Äì Simulateur Gratuit 2025 | RetraiteClair" />
    <meta property="twitter:description" content="Estimez vos revenus de retraite progressive 2025 en 2 minutes. Gratuit, sans inscription. D√©couvrez votre √©ligibilit√© d√®s maintenant." />
    <meta property="twitter:image" content="https://retraiteclair.onrender.com/retraite-progressive-hero.png" />

    <link rel="apple-touch-icon" href="%PUBLIC_URL%/logo192.png" />
    <link rel="manifest" href="%PUBLIC_URL%/manifest.json" />
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <title>Calculez votre Retraite Progressive en 2 min ‚Äì Simulateur Gratuit 2025 | RetraiteClair</title>
    
    <!-- Canonical URL -->
    <link rel="canonical" href="https://retraiteclair.onrender.com/" />
    
    <!-- JSON-LD Structured Data -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebSite",
      "name": "RetraiteClair",
      "description": "Simulateur de retraite progressive gratuit pour calculer vos revenus 2025",
      "url": "https://retraiteclair.onrender.com",
      "potentialAction": {
        "@type": "SearchAction",
        "target": "https://retraiteclair.onrender.com/calculateur",
        "query-input": "required name=search_term_string"
      },
      "publisher": {
        "@type": "Organization",
        "name": "RetraiteClair",
        "url": "https://retraiteclair.onrender.com"
      }
    }
    </script>

    <!-- Google Search Console Verification -->
    <meta name="google-site-verification" content="sjDIWqfTOwIzYu1X9ru-AG5NHm7MVgLDU5SrvZ-onyM" />

    <!-- Meta Pixel Code - Charg√© uniquement apr√®s consentement -->
    <script>
      // Ne charger Meta Pixel que si le consentement a √©t√© donn√©
      function loadMetaPixel() {
        if (typeof window.fbq === 'undefined') {
          !function(f,b,e,v,n,t,s)
          {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
          n.callMethod.apply(n,arguments):n.queue.push(arguments)};
          if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
          n.queue=[];t=b.createElement(e);t.async=!0;
          t.src=v;s=b.getElementsByTagName(e)[0];
          s.parentNode.insertBefore(t,s)}(window, document,'script',
          'https://connect.facebook.net/en_US/fbevents.js');
          
          // Initialiser Meta Pixel
          fbq('init', '736513402739299', {
            autoConfig: false,
            debug: false
          });
          
          fbq('set', 'autoConfig', false, '736513402739299');
          fbq('consent', 'grant');
          fbq('track', 'PageView');
        }
      }
      
      // V√©rifier le consentement existant au chargement
      const metaPixelConsent = localStorage.getItem('retraiteClair_cookieConsent') || localStorage.getItem('consent-given');
      if (metaPixelConsent === 'accepted' || metaPixelConsent === 'true') {
        loadMetaPixel();
      } else {
        // Initialiser fbq en mode refus√© par d√©faut
        window.fbq = window.fbq || function() {
          (window.fbq.q = window.fbq.q || []).push(arguments);
        };
        fbq('consent', 'revoke');
      }
    </script>
    <noscript>
      <img height="1" width="1" style="display:none"
           src="https://www.facebook.com/tr?id=736513402739299&ev=PageView&noscript=1"/>
    </noscript>
    <!-- End Meta Pixel Code -->

  </head>
  <body>

    <!-- Contenu de fallback pour les moteurs de recherche et sans JavaScript -->
    <noscript>
      <div style="max-width: 1200px; margin: 0 auto; padding: 20px; font-family: Arial, sans-serif;">
        <header style="text-align: center; margin-bottom: 40px;">
          <h1 style="color: #0f766e; font-size: 2.5rem; margin-bottom: 10px;">RetraiteClair</h1>
          <p style="font-size: 1.2rem; color: #666;">Simulateur de retraite progressive gratuit</p>
        </header>
        
        <main>
          <section style="background: #f8fafc; padding: 30px; border-radius: 12px; margin-bottom: 30px;">
            <h2 style="color: #1e293b; margin-bottom: 20px;">Qu'est-ce que la retraite progressive ?</h2>
            <p style="line-height: 1.6; margin-bottom: 15px;">
              La retraite progressive vous permet de travailler √† temps partiel (40% √† 80%) tout en percevant une partie de votre retraite. 
              C'est une transition en douceur vers la retraite d√©finitive.
            </p>
            <p style="line-height: 1.6;">
              <strong>Avantages :</strong> Continuez √† cotiser, optimisez votre fiscalit√©, testez votre nouveau rythme de vie.
            </p>
          </section>
          
          <section style="margin-bottom: 30px;">
            <h2 style="color: #1e293b; margin-bottom: 20px;">Fonctionnalit√©s du simulateur</h2>
            <ul style="line-height: 1.8;">
              <li>‚úÖ <strong>Calcul de vos revenus</strong> en retraite progressive</li>
              <li>‚úÖ <strong>V√©rification d'√©ligibilit√©</strong> selon votre situation</li>
              <li>‚úÖ <strong>Impact fiscal</strong> et optimisations possibles</li>
              <li>‚úÖ <strong>Conseils personnalis√©s</strong> pour votre transition</li>
              <li>‚úÖ <strong>Guide complet</strong> des d√©marches administratives</li>
            </ul>
          </section>
          
          <section style="background: #e0f2fe; padding: 30px; border-radius: 12px; margin-bottom: 30px;">
            <h2 style="color: #1e293b; margin-bottom: 20px;">Comment utiliser le simulateur ?</h2>
            <ol style="line-height: 1.8;">
              <li><strong>Activez JavaScript</strong> dans votre navigateur pour acc√©der au simulateur interactif</li>
              <li><strong>Renseignez vos informations</strong> : √¢ge, salaire, trimestres cotis√©s</li>
              <li><strong>Choisissez votre temps partiel</strong> souhait√© (40% √† 80%)</li>
              <li><strong>Consultez les r√©sultats</strong> et optimisez votre strat√©gie</li>
            </ol>
          </section>
          
          <section style="text-align: center; padding: 30px;">
            <h2 style="color: #1e293b; margin-bottom: 20px;">Pr√™t √† simuler votre retraite progressive ?</h2>
            <p style="margin-bottom: 20px; font-size: 1.1rem;">
              Activez JavaScript pour acc√©der au simulateur interactif et personnalis√©.
            </p>
            <div style="background: #f0f9ff; padding: 20px; border-radius: 8px; display: inline-block;">
              <p style="margin: 0; color: #0369a1;">
                <strong>üí° Conseil :</strong> Le simulateur fonctionne mieux avec JavaScript activ√© pour une exp√©rience optimale.
              </p>
            </div>
          </section>
        </main>
        
        <footer style="text-align: center; margin-top: 40px; padding-top: 20px; border-top: 1px solid #e2e8f0; color: #666;">
          <p>¬© 2024 RetraiteClair - Simulateur de retraite progressive gratuit</p>
          <p>Informations bas√©es sur la r√©glementation 2024</p>
        </footer>
      </div>
    </noscript>
    
    <div id="root"></div>

    <!-- RGPD Consent Banner -->
    <div id="consent-banner" style="display: none;">
      <div style="background: #f8f9fa; padding: 20px; border-top: 2px solid #0f766e; position: fixed; bottom: 0; left: 0; right: 0; z-index: 1000; box-shadow: 0 -2px 10px rgba(0,0,0,0.1);">
        <div style="max-width: 1200px; margin: 0 auto; display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 15px;">
          <div style="flex: 1; min-width: 300px;">
            <p style="margin: 0; font-size: 14px; color: #333; line-height: 1.4;">
              üç™ Nous utilisons des cookies et Meta Pixel pour am√©liorer votre exp√©rience et mesurer nos performances. 
              <a href="/privacy-policy" style="color: #0f766e; text-decoration: underline;">En savoir plus</a>
            </p>
          </div>
          <div style="display: flex; gap: 10px; flex-wrap: wrap;">
            <button onclick="acceptCookies()" style="background: #0f766e; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; font-weight: 500; transition: background 0.2s;">
              Accepter
            </button>
            <button onclick="declineCookies()" style="background: #6c757d; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; font-weight: 500; transition: background 0.2s;">
              Refuser
            </button>
          </div>
        </div>
      </div>
    </div>

    <script>
    // RGPD Consent Management
    function acceptCookies() {
      localStorage.setItem('retraiteClair_cookieConsent', 'accepted');
      localStorage.setItem('retraiteClair_cookieConsentDate', new Date().toISOString());
      localStorage.setItem('consent-given', 'true');
      localStorage.setItem('consent-date', new Date().toISOString());
      document.getElementById('consent-banner').style.display = 'none';
      
      // Charger et activer GA4
      if (typeof loadGoogleAnalytics === 'function') {
        loadGoogleAnalytics();
      }
      if (typeof gtag !== 'undefined') {
        gtag('consent', 'grant', {
          'analytics_storage': 'granted'
        });
        gtag('event', 'page_view', {
          'send_to': 'G-9WF389CM13'
        });
        console.log('GA4 consent granted and PageView tracked');
      }
      
      // Charger et activer Meta Pixel
      if (typeof loadMetaPixel === 'function') {
        loadMetaPixel();
      }
      if (typeof fbq !== 'undefined') {
        fbq('consent', 'grant');
        fbq('track', 'PageView');
        console.log('Meta Pixel consent granted and PageView tracked');
      }
      
      // D√©clencher l'√©v√©nement pour le composant React CookieBanner
      window.dispatchEvent(new CustomEvent('cookieConsentChanged', { detail: { accepted: true } }));
    }

    function declineCookies() {
      localStorage.setItem('retraiteClair_cookieConsent', 'rejected');
      localStorage.setItem('retraiteClair_cookieConsentDate', new Date().toISOString());
      localStorage.setItem('consent-given', 'false');
      localStorage.setItem('consent-date', new Date().toISOString());
      document.getElementById('consent-banner').style.display = 'none';
      
      // D√©sactiver GA4
      if (typeof gtag !== 'undefined') {
        gtag('consent', 'revoke', {
          'analytics_storage': 'denied'
        });
        console.log('GA4 consent revoked');
      }
      
      // D√©sactiver Meta Pixel
      if (typeof fbq !== 'undefined') {
        fbq('consent', 'revoke');
        console.log('Meta Pixel consent revoked');
      }
      
      // Supprimer les cookies analytiques
      document.cookie.split(";").forEach((c) => {
        const cookieName = c.split("=")[0].trim();
        if (cookieName.startsWith('_ga') || cookieName.startsWith('_gid') || cookieName.startsWith('_gat')) {
          document.cookie = `${cookieName}=;expires=Thu, 01 Jan 1970 00:00:00 UTC;path=/;`;
        }
      });
      
      // D√©clencher l'√©v√©nement pour le composant React CookieBanner
      window.dispatchEvent(new CustomEvent('cookieConsentChanged', { detail: { accepted: false } }));
    }

    // V√©rifier le consentement au chargement
    document.addEventListener('DOMContentLoaded', function() {
      const consent = localStorage.getItem('retraiteClair_cookieConsent') || localStorage.getItem('consent-given');
      const consentDate = localStorage.getItem('retraiteClair_cookieConsentDate') || localStorage.getItem('consent-date');
      
      // Si pas de consentement ou consentement ancien (> 13 mois), afficher la banni√®re
      if (!consent || !consentDate) {
        document.getElementById('consent-banner').style.display = 'block';
      } else {
        const thirteenMonthsAgo = new Date();
        thirteenMonthsAgo.setMonth(thirteenMonthsAgo.getMonth() - 13);
        
        if (new Date(consentDate) < thirteenMonthsAgo) {
          document.getElementById('consent-banner').style.display = 'block';
        } else if (consent === 'rejected' || consent === 'false') {
          // D√©sactiver GA4 et Meta Pixel si refus√©
          if (typeof gtag !== 'undefined') {
            gtag('consent', 'revoke', {
              'analytics_storage': 'denied'
            });
          }
          if (typeof fbq !== 'undefined') {
            fbq('consent', 'revoke');
          }
        }
      }
    });
    </script>
  </body>
</html>